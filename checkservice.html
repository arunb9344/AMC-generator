<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMC Agreement Generator - Eye Tech Securities</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            width: 100%;
            background: white;
            min-height: 100vh;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header nav {
            margin-top: 15px;
        }

        .header nav a {
            color: white;
            text-decoration: none;
            margin: 0 10px;
            opacity: 0.9;
            font-size: 1rem;
        }

        .header nav a:hover {
            opacity: 1;
            text-decoration: underline;
        }

        .form-container {
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .form-section {
            margin-bottom: 35px;
        }

        .section-title {
            font-size: 1.4rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            background: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        #particularsTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        #particularsTable th,
        #particularsTable td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        #particularsTable th {
            background-color: #f8f9fa;
            font-weight: bold;
        }

        .total-amount {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-top: 15px;
        }

        .signature-upload {
            position: relative;
            display: inline-block;
            width: 200px;
            height: 100px;
            border: 2px dashed #e0e6ed;
            border-radius: 8px;
            text-align: center;
            line-height: 100px;
            cursor: pointer;
            background: #f8f9fa;
        }

        .signature-upload img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .remove-signature {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-container {
            text-align: center;
            margin-top: 30px;
        }

        .email-options {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .form-container {
                padding: 20px;
            }

            #particularsTable {
                font-size: 0.8rem;
            }

            #particularsTable th,
            #particularsTable td {
                padding: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AMC Agreement Generator</h1>
            <nav>
                <a href="#">AMC Agreement</a>
                <a href="#">Service Report</a>
                <a href="#">Quotation</a>
            </nav>
        </div>

        <div class="form-container">
            <form id="agreementForm">
                <!-- Customer Details -->
                <div class="form-section">
                    <h2 class="section-title">Customer Details</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="customerName">Customer Name *</label>
                            <input type="text" id="customerName" name="customerName" required>
                        </div>
                        <div class="form-group">
                            <label for="contactPerson">Contact Person</label>
                            <input type="text" id="contactPerson" name="contactPerson">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="customerAddress">Customer Address *</label>
                        <textarea id="customerAddress" name="customerAddress" rows="3" required></textarea>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="customerContact">Customer Contact Number *</label>
                            <input type="tel" id="customerContact" name="customerContact" required>
                        </div>
                        <div class="form-group">
                            <label for="customerEmail">Customer Email</label>
                            <input type="email" id="customerEmail" name="customerEmail">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="customerGST">Customer GST (Optional)</label>
                        <input type="text" id="customerGST" name="customerGST">
                    </div>
                </div>

                <!-- Agreement Details -->
                <div class="form-section">
                    <h2 class="section-title">Agreement Details</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="agreementDate">Agreement Date *</label>
                            <input type="date" id="agreementDate" name="agreementDate" required>
                        </div>
                        <div class="form-group">
                            <label for="contractPeriod">Contract Period (Years)</label>
                            <select id="contractPeriod" name="contractPeriod" required>
                                <option value="1">1 Year</option>
                                <option value="2">2 Years</option>
                                <option value="3">3 Years</option>
                                <option value="4">4 Years</option>
                                <option value="5">5 Years</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="includeConnector">
                                <input type="checkbox" id="includeConnector" name="includeConnector" checked> Include Free Connector Replacement
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Particulars -->
                <div class="form-section">
                    <h2 class="section-title">Particulars</h2>
                    <button type="button" class="btn" onclick="addParticular()" style="background: #27ae60; margin-bottom: 15px;">Add Particular</button>
                    <table id="particularsTable">
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th>Qty</th>
                                <th>Total Amount</th>
                                <th>Maintenance Visits</th>
                                <th>Breakdown Visits</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div class="total-amount" id="totalAmount">Total Amount: Rs. 0</div>
                </div>

                <!-- Signature -->
                <div class="form-section">
                    <h2 class="section-title">Signature</h2>
                    <div class="form-group">
                        <label for="signatureImage">Upload Signature Image (Optional)</label>
                        <input type="file" id="signatureImage" name="signatureImage" accept="image/*" style="display: none;" onchange="previewSignature(this)">
                        <div id="signaturePreview" class="signature-upload" onclick="document.getElementById('signatureImage').click()">
                            Click to upload signature
                        </div>
                    </div>
                </div>

                <!-- Email Options -->
                <div class="form-section">
                    <h2 class="section-title">Email Options</h2>
                    <div class="email-options">
                        <label>
                            <input type="checkbox" id="sendToCustomer" name="sendToCustomer" checked> Send copy to customer
                        </label>
                        <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">Admin copy will always be sent to support@eyetechsecurities.in</p>
                    </div>
                </div>

                <div class="btn-container">
                    <button type="button" class="btn" onclick="generateAgreementPDF()">Generate PDF Only</button>
                    <button type="button" class="btn" onclick="generateAndEmail()">Generate PDF & Send Email</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Set today's date as default
        document.getElementById('agreementDate').valueAsDate = new Date();

        let particularCounter = 0;
        let totalAmount = 0;

        function addParticular() {
            particularCounter++;
            const tbody = document.querySelector('#particularsTable tbody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" placeholder="Description" class="desc-input" required></td>
                <td><input type="number" placeholder="Qty" class="qty-input" min="1" value="1" required></td>
                <td><input type="number" placeholder="Total Amount" class="totalAmount-input" min="0" required></td>
                <td><input type="number" placeholder="Maintenance Visits" class="maintenance-input" min="0" value="0"></td>
                <td><input type="number" placeholder="Breakdown Visits" class="breakdown-input" min="0" value="0"></td>
                <td><button type="button" class="btn" style="background: #e74c3c; padding: 5px 10px; font-size: 0.8rem;" onclick="removeParticular(this)">Remove</button></td>
            `;
            tbody.appendChild(row);
            attachEventListeners(row);
            updateTotal();
        }

        function attachEventListeners(row) {
            const totalAmountInput = row.querySelector('.totalAmount-input');
            totalAmountInput.addEventListener('input', updateRowAmount);
        }

        function updateRowAmount() {
            const row = this.closest('tr');
            const total = parseFloat(row.querySelector('.totalAmount-input').value) || 0;
            updateTotal();
        }

        function removeParticular(button) {
            button.closest('tr').remove();
            updateTotal();
        }

        function updateTotal() {
            totalAmount = 0;
            document.querySelectorAll('#particularsTable tbody tr').forEach(row => {
                const totalText = row.querySelector('.totalAmount-input').value;
                totalAmount += parseFloat(totalText) || 0;
            });
            document.getElementById('totalAmount').textContent = `Total Amount: Rs. ${totalAmount.toLocaleString()}`;
        }

        function previewSignature(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('signaturePreview');
                    preview.innerHTML = `<img src="${e.target.result}" alt="Signature"><button class="remove-signature" onclick="removeSignature()">×</button>`;
                };
                reader.readAsDataURL(file);
            }
        }

        function removeSignature() {
            document.getElementById('signatureImage').value = '';
            document.getElementById('signaturePreview').innerHTML = 'Click to upload signature';
        }

        function collectFormData() {
            const formData = new FormData(document.getElementById('agreementForm'));
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            data.particulars = [];
            document.querySelectorAll('#particularsTable tbody tr').forEach(row => {
                const desc = row.querySelector('.desc-input').value;
                const qty = row.querySelector('.qty-input').value;
                const totalAmount = row.querySelector('.totalAmount-input').value;
                const maintenance = row.querySelector('.maintenance-input').value;
                const breakdown = row.querySelector('.breakdown-input').value;
                const amount = parseFloat(totalAmount) || 0;
                if (desc) {
                    data.particulars.push({ desc, qty, totalAmount, maintenance, breakdown, amount });
                }
            });
            data.totalAmount = totalAmount;
            data.includeConnector = document.getElementById('includeConnector').checked;
            data.signatureDataUrl = document.querySelector('#signaturePreview img') ? document.querySelector('#signaturePreview img').src : null;
            return data;
        }

        function generateAgreementPDF() {
            const data = collectFormData();
            if (!data.customerName || !data.customerAddress || !data.customerContact || !data.agreementDate || !data.contractPeriod || data.particulars.length === 0) {
                alert('Please fill in all required fields and add at least one particular.');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Header
            doc.setFillColor(44, 62, 80);
            doc.rect(0, 0, 210, 45, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text('EYE TECH SECURITIES', 105, 15, { align: 'center' });
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text('No.56/80, Medavakkam Main Road, Keelkattalai, Chennai-600117', 105, 23, { align: 'center' });
            doc.text('Ph: 9962835944 | Mail: support@eyetechsecurities.in', 105, 29, { align: 'center' });
            doc.text('GST No: 33BCMPA5207N1ZN', 105, 35, { align: 'center' });
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('Professional CCTV Maintenance Services', 105, 41, { align: 'center' });

            // Title
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(52, 152, 219);
            doc.text('AMC AGREEMENT', 105, 60, { align: 'center' });
            doc.setDrawColor(52, 152, 219);
            doc.setLineWidth(0.5);
            doc.line(70, 63, 140, 63);

            // Agreement Details
            let currentY = 70;
            doc.setFillColor(248, 249, 250);
            doc.rect(15, currentY, 180, 25, 'F');
            doc.setDrawColor(224, 230, 237);
            doc.rect(15, currentY, 180, 25);
            doc.setTextColor(44, 62, 80);
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            doc.text('AGREEMENT DETAILS', 20, currentY + 8);
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(0, 0, 0);
            doc.text(`Agreement No: AGR/${new Date(data.agreementDate).getFullYear()}/${String(Math.floor(Math.random() * 1000)).padStart(3, '0')}`, 20, currentY + 15);
            doc.text(`Date: ${new Date(data.agreementDate).toLocaleDateString('en-IN')}`, 20, currentY + 22);
            doc.text(`Contract Period: ${data.contractPeriod} Year${data.contractPeriod > 1 ? 's' : ''}`, 120, currentY + 15);
            doc.text('Valid from agreement date', 120, currentY + 22);
            currentY += 35;

            // Customer Details
            doc.setFillColor(44, 62, 80);
            doc.rect(15, currentY, 180, 8, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('CUSTOMER DETAILS', 20, currentY + 5);
            let lineY = currentY + 15;
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            doc.text(`Name: ${data.customerName}`, 20, lineY);
            lineY += 7;
            if (data.contactPerson) {
                doc.text(`Contact Person: ${data.contactPerson}`, 20, lineY);
                lineY += 7;
            }
            doc.text(`Phone: ${data.customerContact}`, 20, lineY);
            lineY += 7;
            if (data.customerEmail) {
                doc.text(`Email: ${data.customerEmail}`, 20, lineY);
                lineY += 7;
            }
            lineY += 7; // space before address
            const addressLines = doc.splitTextToSize(`Address: ${data.customerAddress}`, 170);
            addressLines.forEach(line => {
                doc.text(line, 20, lineY);
                lineY += 7;
            });
            if (data.customerGST) {
                doc.text(`GST Number: ${data.customerGST}`, 20, lineY);
                lineY += 7;
            }
            currentY = lineY + 10;

            // Particulars Table
            if (currentY > 250) {
                doc.addPage();
                currentY = 20;
            }
            doc.setFillColor(44, 62, 80);
            doc.rect(15, currentY, 180, 8, 'F');
            doc.setTextColor(255, 255, 255);
            doc.text('PARTICULARS', 20, currentY + 5);
            currentY += 15;
            const headerHeight = 20;
            doc.setFillColor(248, 249, 250);
            doc.rect(15, currentY, 180, headerHeight, 'F');
            doc.setDrawColor(224, 230, 237);
            doc.rect(15, currentY, 180, headerHeight);
            doc.setTextColor(44, 62, 80);
            doc.setFontSize(9);
            doc.setFont(undefined, 'bold');
            doc.text('DESCRIPTION', 20, currentY + 6);
            const maintLines = doc.splitTextToSize('Maintenance Visits', 20);
            maintLines.forEach((l, i) => doc.text(l, 115, currentY + 6 + i * 4));
            const breakLines = doc.splitTextToSize('Breakdown Visits', 20);
            breakLines.forEach((l, i) => doc.text(l, 135, currentY + 6 + i * 4));
            doc.text('AMOUNT', 155, currentY + 6);
            currentY += headerHeight + 2;

            data.particulars.forEach(part => {
                if (currentY > 250) {
                    doc.addPage();
                    currentY = 20;
                }
                doc.setDrawColor(224, 230, 237);
                let fullDesc = `${part.desc} (${part.qty})`;
                if (parseInt(part.maintenance) > 0 || parseInt(part.breakdown) > 0) {
                    fullDesc += ` - Maintenance: ${part.maintenance} visits, Breakdown: ${part.breakdown} visits`;
                }
                const descLines = doc.splitTextToSize(fullDesc, 90);
                let numLines = Math.max(1, descLines.length);
                let rowHeight = 10 + numLines * 6;
                doc.rect(15, currentY, 180, rowHeight);
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(9);
                doc.setFont(undefined, 'normal');
                descLines.forEach((line, idx) => {
                    doc.text(line, 20, currentY + 4 + idx * 6);
                });
                let textY = currentY + rowHeight - 4;
                doc.text(part.maintenance, 115, textY);
                doc.text(part.breakdown, 135, textY);
                doc.text(`Rs. ${part.amount.toLocaleString()}`, 155, textY);
                currentY += rowHeight + 2;
            });

            // Total
            if (currentY > 250) {
                doc.addPage();
                currentY = 20;
            }
            doc.setDrawColor(52, 152, 219);
            doc.line(160, currentY, 195, currentY);
            currentY += 5;
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text(`TOTAL: Rs. ${data.totalAmount.toLocaleString()}`, 170, currentY);
            currentY += 20;

            // Terms & Conditions
            if (currentY > 250) {
                doc.addPage();
                currentY = 20;
            }
            doc.setFillColor(44, 62, 80);
            doc.rect(15, currentY, 180, 8, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('TERMS & CONDITIONS', 20, currentY + 5);

            currentY += 15;
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');

            const termTexts = [
                "The contract is applicable for the selected period from the agreement date.",
                "Contract does not cover damages due to natural disasters, misuse, power surges, lightning, fire, flood, earthquake, or act of God.",
                "Equipment must be in working condition at contract signing; customer bears initial repair cost if faulty.",
                "Customer must provide ladder, water, power supply, and civil support for maintenance.",
                "Missing/stolen items during the contract are customer's liability, not covered under AMC.",
                "Technician access required during scheduled visits; no refund for missed appointments due to unavailability.",
                "Breakdown visits during working hours (Mon-Sat, 9 AM-6 PM); emergency visits may be charged.",
                "Contract is non-transferable and non-terminable before completion.",
                "Payment due within 30 days of invoice; 2% monthly penalty on overdue amounts.",
                "Maintenance includes cleaning, adjustments, calibration, software updates, and health checks.",
                "Only registered complaints via proper channels are addressed during breakdown visits.",
                "Warranty-covered items replaced free; out-of-warranty items chargeable.",
                "Material replacements, spare parts, and consumables chargeable unless under warranty.",
                "Connector replacement (Rs. 500/camera) included in first maintenance visit only.",
                "Unauthorized equipment modification voids the AMC contract.",
                "Service visits scheduled with 24-48 hours notice to customer.",
                "Customer responsible for data backup; Eye Tech Securities not liable for data loss.",
                "Additional work beyond AMC scope chargeable per prevailing rates.",
                "Disputes subject to local court jurisdiction.",
                "This contract supersedes prior agreements; modifications require mutual written consent.",
                "Force majeure conditions may temporarily suspend service obligations.",
                "Maintenance visits non-transferable and not carried forward.",
                "18% GST applies on total contract amount per tax regulations."
            ];

            let terms = termTexts.slice(0, 13); // Terms 1-13
            if (data.includeConnector) {
                terms.push(termTexts[13]); // Include 14th term (original 15th)
            }
            terms = terms.concat(termTexts.slice(14)); // Terms 15-24 (adjusted)

            terms.forEach((term, index) => {
                if (currentY > 270) {
                    doc.addPage();
                    currentY = 20;
                }
                const numberedTerm = `${index + 1}) ${term}`;
                const termLines = doc.splitTextToSize(numberedTerm, 170);
                termLines.forEach(line => {
                    doc.text(line, 20, currentY);
                    currentY += 4.5;
                });
                currentY += 1;
            });

            // Signature Section
            if (currentY > 240) {
                doc.addPage();
                currentY = 20;
            }
            currentY += 20;
            doc.setDrawColor(224, 230, 237);
            doc.setLineWidth(0.5);
            doc.line(20, currentY, 80, currentY);
            doc.line(130, currentY, 190, currentY);
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.text('Customer Signature', 20, currentY + 8);
            doc.text('Eye Tech Securities', 130, currentY + 8);
            doc.setFont(undefined, 'normal');
            doc.text('Date: ___________', 20, currentY + 15);
            doc.text('Authorized Signatory', 130, currentY + 15);

            // Add uploaded signature if available
            if (data.signatureDataUrl) {
                doc.addImage(data.signatureDataUrl, 'PNG', 25, currentY - 5, 50, 20);
            }

            currentY += 30;
            doc.setFontSize(8);
            doc.setTextColor(100, 100, 100);
            doc.text('This is a computer-generated agreement.', 105, currentY, { align: 'center' });

            const fileName = `AMC_Agreement_${data.customerName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
        }

        function generateAndEmail() {
            // For now, just generate PDF; email functionality would require backend
            alert('PDF generated. Email sending requires server-side implementation.');
            generateAgreementPDF();
        }
    </script>
</body>
</html>
