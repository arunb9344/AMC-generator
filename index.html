<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMC Agreement Generator - Eye Tech Securities</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        .form-section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .form-section h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        .input-field {
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 0.5rem;
            width: 100%;
            margin-bottom: 1rem;
        }
        .particular-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
        }
        .particular-row input {
            flex: 1;
        }
        .btn-primary {
            background-color: #2563eb;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #1d4ed8;
        }
        .btn-secondary {
            background-color: #6b7280;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
        }
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        #total-amount {
            font-weight: 600;
            color: #1f2937;
            margin-top: 1rem;
        }
        #error-message {
            color: #dc2626;
            margin-top: 1rem;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-section">
            <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">AMC Agreement Generator</h1>
            <form id="amc-form">
                <div class="form-section">
                    <h2>Customer Details</h2>
                    <label for="customer-name" class="block text-sm font-medium text-gray-700">Customer Name</label>
                    <input type="text" id="customer-name" class="input-field" required>

                    <label for="customer-address" class="block text-sm font-medium text-gray-700">Customer Address</label>
                    <input type="text" id="customer-address" class="input-field" required>

                    <label for="contact-person" class="block text-sm font-medium text-gray-700">Contact Person</label>
                    <input type="text" id="contact-person" class="input-field" required>

                    <label for="customer-contact" class="block text-sm font-medium text-gray-700">Customer Contact Number</label>
                    <input type="text" id="customer-contact" class="input-field" required>

                    <label for="customer-email" class="block text-sm font-medium text-gray-700">Customer Email</label>
                    <input type="email" id="customer-email" class="input-field" required>

                    <label for="customer-gst" class="block text-sm font-medium text-gray-700">Customer GST (Optional)</label>
                    <input type="text" id="customer-gst" class="input-field">
                </div>

                <div class="form-section mt-6">
                    <h2>Contract Details</h2>
                    <label for="contract-period" class="block text-sm font-medium text-gray-700">Contract Period (Years)</label>
                    <select id="contract-period" class="input-field" required>
                        <option value="1">1 Year</option>
                        <option value="2">2 Years</option>
                        <option value="3">3 Years</option>
                        <option value="4">4 Years</option>
                        <option value="5">5 Years</option>
                    </select>
                </div>

                <div class="form-section mt-6">
                    <h2>Particulars</h2>
                    <div id="particulars-container"></div>
                    <button type="button" onclick="addParticularRow()" class="btn-secondary mt-4">Add Particular</button>
                    <div id="total-amount">Total Amount: Rs.0</div>
                </div>

                <button type="button" onclick="generatePDF()" class="btn-primary mt-6 w-full">Generate PDF</button>
                <div id="error-message"></div>
            </form>
        </div>
    </div>

    <script>
        function addParticularRow() {
            const container = document.getElementById('particulars-container');
            const row = document.createElement('div');
            row.className = 'particular-row';
            row.innerHTML = `
                <input type="text" placeholder="Particular (e.g., CCTV, Biometrics)" class="input-field" required>
                <input type="number" placeholder="Maintenance Visits" min="0" class="input-field" required>
                <input type="number" placeholder="Breakdown Visits" min="0" class="input-field" required>
                <input type="number" placeholder="Amount (Rs.)" min="0" step="0.01" class="input-field" required>
                <button type="button" onclick="this.parentNode.remove(); updateTotalAmount()" class="btn-secondary">Remove</button>
            `;
            container.appendChild(row);
            row.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('input', updateTotalAmount);
            });
        }

        function updateTotalAmount() {
            const rows = document.querySelectorAll('.particular-row');
            let total = 0;
            rows.forEach(row => {
                const amountInput = row.querySelector('input[placeholder="Amount (Rs.)"]');
                if (amountInput && amountInput.value) {
                    total += parseFloat(amountInput.value) || 0;
                }
            });
            document.getElementById('total-amount').textContent = `Total Amount: Rs.${total.toFixed(2)}`;
        }

        function generatePDF() {
            const errorMessage = document.getElementById('error-message');
            errorMessage.style.display = 'none';

            try {
                const { jsPDF } = window.jspdf;
                if (!jsPDF) {
                    throw new Error('jsPDF library failed to load. Check your internet connection or script source.');
                }
                const doc = new jsPDF();

                // Header
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(20);
                doc.setTextColor(31, 41, 55); // Gray-800
                doc.text('Eye Tech Securities', 105, 20, { align: 'center' });
                doc.setFontSize(16);
                doc.text('Annual Maintenance Contract (AMC) Agreement', 105, 30, { align: 'center' });
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128); // Gray-500
                doc.text('No.56/80, Medavakkam Main Road, Keelkattalai, Chennai-600117', 105, 40, { align: 'center' });
                doc.text('GST: 33BCMPA5207N1ZN | Ph: 9962835944 | support@eyetechsecurities.in', 105, 45, { align: 'center' });
                doc.setDrawColor(37, 99, 235); // Blue-600
                doc.setLineWidth(0.5);
                doc.line(20, 50, 190, 50);

                // AMC Number and Date
                const today = new Date(2025, 7, 17); // August 17, 2025
                today.setHours(13, 26, 0, 0); // Set to 01:26 PM IST
                const year = today.getFullYear();
                const randomSuffix = Math.floor(Math.random() * 900) + 100;
                const amcNumber = `ETS-AMC-${year}-${randomSuffix.toString().padStart(3, '0')}`;
                const amcDate = today.toLocaleString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true });
                const validUntil = new Date(today);
                validUntil.setFullYear(validUntil.getFullYear() + parseInt(document.getElementById('contract-period').value));
                const validUntilDate = validUntil.toLocaleDateString('en-IN', { year: 'numeric', month: 'numeric', day: 'numeric' });

                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(55, 65, 81); // Gray-700
                doc.text(`AMC Number: ${amcNumber}`, 20, 60);
                const rows = document.querySelectorAll('.particular-row');
                let totalAmount = 0;
                rows.forEach(row => {
                    const amountInput = row.querySelector('input[placeholder="Amount (Rs.)"]');
                    if (amountInput && amountInput.value) {
                        totalAmount += parseFloat(amountInput.value) || 0;
                    }
                });
                doc.text(`Total Amount: Rs.${totalAmount.toFixed(2)}`, 20, 68);
                doc.text(`AMC Date: ${amcDate} IST`, 20, 76);
                doc.text(`Valid Until: ${validUntilDate}`, 20, 84);

                // Customer Details
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('Customer Details', 20, 100);
                doc.setLineWidth(0.2);
                doc.line(20, 102, 60, 102);
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                const customerName = document.getElementById('customer-name').value;
                const customerAddress = document.getElementById('customer-address').value;
                const contactPerson = document.getElementById('contact-person').value;
                const customerContact = document.getElementById('customer-contact').value;
                const customerEmail = document.getElementById('customer-email').value;
                const customerGST = document.getElementById('customer-gst').value;
                doc.text(`Name: ${customerName}`, 20, 110);
                doc.text(`Address: ${customerAddress}`, 20, 118);
                doc.text(`Contact Person: ${contactPerson}`, 20, 126);
                doc.text(`Phone: ${customerContact}`, 20, 134);
                doc.text(`Email: ${customerEmail}`, 20, 142);
                let gstY = 150;
                if (customerGST) {
                    doc.text(`GST: ${customerGST}`, 20, gstY);
                    gstY += 8;
                }

                // Contract Period
                const contractPeriod = parseInt(document.getElementById('contract-period').value);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('Contract Details', 20, gstY + 10);
                doc.line(20, gstY + 12, 60, gstY + 12);
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.text(`Contract Period: ${contractPeriod} Year(s)`, 20, gstY + 20);

                // Particulars Table
                const particulars = [];
                totalAmount = 0;
                rows.forEach(row => {
                    const inputs = row.querySelectorAll('input');
                    if (inputs.length === 4) {
                        const amount = parseFloat(inputs[3].value) || 0;
                        totalAmount += amount;
                        particulars.push([
                            inputs[0].value,
                            inputs[1].value,
                            inputs[2].value,
                            `Rs.${amount.toFixed(2)}`
                        ]);
                    }
                });

                if (particulars.length > 0) {
                    doc.setFontSize(14);
                    doc.setFont('helvetica', 'bold');
                    doc.text('Equipment Covered', 20, gstY + 35);
                    doc.line(20, gstY + 37, 70, gstY + 37);
                    doc.autoTable({
                        startY: gstY + 45,
                        head: [['S.No', 'Equipment Type', 'Maintenance Visits', 'Breakdown Visits']],
                        body: particulars.map((item, index) => [index + 1, item[0], item[1], item[2]]),
                        theme: 'grid',
                        styles: { fontSize: 10, cellPadding: 4, textColor: [55, 65, 81] },
                        headStyles: { fillColor: [37, 99, 235], textColor: [255, 255, 255], fontStyle: 'bold' },
                        columnStyles: {
                            0: { cellWidth: 20 },
                            1: { cellWidth: 60 },
                            2: { cellWidth: 40 },
                            3: { cellWidth: 40 }
                        }
                    });
                }

                // Terms and Conditions
                let startY = doc.lastAutoTable ? doc.lastAutoTable.finalY + 20 : gstY + 35; // Increased spacing to avoid overlap
                doc.setFontSize(10); // Reduced font size for better fit
                doc.setFont('helvetica', 'bold');
                doc.text('Terms and Conditions', 20, startY);
                doc.line(20, startY + 2, 70, startY + 2);
                doc.setFontSize(9); // Further reduced to ensure 2-page limit
                doc.setFont('helvetica', 'normal');
                const terms = [
                    `1. The contract is applicable for ${contractPeriod * 12} months from the agreement date.`,
                    '2. Contract does not cover damages due to natural disasters, misuse, power surges, lightning, fire, flood, earthquake, or any act of God.',
                    '3. Offer valid for 30 days from issue date.',
                    '4. Equipment must be in working condition at contract signing; customer to bear initial repair cost if faulty.',
                    '5. Customer must provide ladder, water, power supply, and civil support for maintenance.',
                    '6. Missing/stolen items during the contract are customer\'s liability, not covered under AMC.',
                    '7. Technician access is required during scheduled visits; no refund for missed appointments due to unavailability.',
                    '8. Breakdown visits are during working hours (Mon-Sat, 9 AM-6 PM); emergency visits may be charged.',
                    '9. Contract is non-transferable and non-terminable before completion.',
                    '10. Payment due within 30 days of invoice; 2% monthly penalty on overdue amounts.',
                    '11. Maintenance includes cleaning, adjustments, calibration, software updates, and health checks.',
                    '12. Only registered complaints via proper channels are addressed during breakdown visits.',
                    '13. Warranty-covered items are replaced free; out-of-warranty items are chargeable.',
                    '14. Material replacements, spare parts, and consumables are chargeable unless under warranty.',
                    '15. Connector replacement (Rs. 500/camera) included in first maintenance visit only.',
                    '16. Unauthorized equipment modification voids the AMC contract.',
                    '17. Service visits scheduled with 24-48 hours notice to the customer.',
                    '18. Customer responsible for data backup; Eye Tech Securities not liable for data loss.',
                    '19. Additional work beyond AMC scope is chargeable per prevailing rates.',
                    '20. Disputes subject to local court jurisdiction.',
                    '21. This contract supersedes prior agreements; modifications require mutual written consent.',
                    '22. Force majeure conditions may temporarily suspend service obligations.',
                    '23. Maintenance visits are non-transferable and not carried forward.',
                    '24. 18% GST applies on the total contract amount per tax regulations.'
                ];
                let currentY = startY + 10;
                terms.forEach((term, index) => {
                    const lines = doc.splitTextToSize(term, 170);
                    if (currentY + lines.length * 6 > 280 - 50) { // Adjusted to 6mm spacing for 2-page fit
                        doc.addPage();
                        currentY = 50;
                        // Add header to new page
                        doc.setFont('helvetica', 'bold');
                        doc.setFontSize(20);
                        doc.setTextColor(31, 41, 55);
                        doc.text('Eye Tech Securities', 105, 20, { align: 'center' });
                        doc.setFontSize(16);
                        doc.text('Annual Maintenance Contract (AMC) Agreement', 105, 30, { align: 'center' });
                        doc.setFontSize(10);
                        doc.setTextColor(107, 114, 128);
                        doc.text('No.56/80, Medavakkam Main Road, Keelkattalai, Chennai-600117', 105, 40, { align: 'center' });
                        doc.text('GST: 33BCMPA5207N1ZN | Ph: 9962835944 | support@eyetechsecurities.in', 105, 45, { align: 'center' });
                        doc.setDrawColor(37, 99, 235);
                        doc.setLineWidth(0.5);
                        doc.line(20, 50, 190, 50);
                    }
                    doc.text(lines, 20, currentY);
                    currentY += lines.length * 6; // Reduced spacing to fit
                });

                // Signatures
                if (currentY + 50 > 280 - 20) {
                    doc.addPage();
                    currentY = 50;
                    // Add header to new page
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(20);
                    doc.setTextColor(31, 41, 55);
                    doc.text('Eye Tech Securities', 105, 20, { align: 'center' });
                    doc.setFontSize(16);
                    doc.text('Annual Maintenance Contract (AMC) Agreement', 105, 30, { align: 'center' });
                    doc.setFontSize(10);
                    doc.setTextColor(107, 114, 128);
                    doc.text('No.56/80, Medavakkam Main Road, Keelkattalai, Chennai-600117', 105, 40, { align: 'center' });
                    doc.text('GST: 33BCMPA5207N1ZN | Ph: 9962835944 | support@eyetechsecurities.in', 105, 45, { align: 'center' });
                    doc.setDrawColor(37, 99, 235);
                    doc.setLineWidth(0.5);
                    doc.line(20, 50, 190, 50);
                }
                doc.setFontSize(12);
                doc.text('Customer', 20, currentY);
                doc.text('Service Provider', 120, currentY);
                currentY += 10;
                doc.line(20, currentY, 70, currentY); // Signature line
                doc.line(120, currentY, 170, currentY); // Signature line
                currentY += 15;
                doc.text(`${contactPerson || '_______________________'}`, 20, currentY);
                doc.text('Authorized Signatory', 120, currentY);
                currentY += 10;
                doc.text(`${customerName || '_______________________'}`, 20, currentY);
                doc.text('Eye Tech Securities', 120, currentY);
                currentY += 10;
                const dateStr = today.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }).split('/').join('/');
                doc.text(dateStr, 20, currentY);
                doc.text(dateStr, 120, currentY);

                // Footer
                doc.setFontSize(9);
                doc.setTextColor(107, 114, 128);
                doc.text(`Page ${doc.internal.getNumberOfPages()}`, 190, 285, { align: 'right' });
                doc.text('Eye Tech Securities | No.56/80, Medavakkam Main Road, Keelkattalai, Chennai-600117 | Ph: 9962835944', 105, 285, { align: 'center' });

                // Save PDF
                doc.save(`AMC_Agreement_${amcNumber}.pdf`);
            } catch (error) {
                errorMessage.textContent = `Error generating PDF: ${error.message}. Please check your browser console for details or ensure an internet connection.`;
                errorMessage.style.display = 'block';
                console.error(error);
            }
        }

        // Add one particular row by default
        addParticularRow();

        // Update total amount on page load
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', updateTotalAmount);
        });

        // Verify script loading
        window.onload = function() {
            if (!window.jspdf || !window.jspdf.jsPDF.prototype.autoTable) {
                document.getElementById('error-message').textContent = 'Required libraries (jsPDF or autoTable) failed to load. Please check your internet connection or try a different browser.';
                document.getElementById('error-message').style.display = 'block';
            }
        };
    </script>
</body>
</html>
